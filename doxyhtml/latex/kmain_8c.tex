\hypertarget{kmain_8c}{}\section{/home/loudish/mpx-\/spring2017-\/modestus/mpx\+\_\+core/kernel/core/kmain.c File Reference}
\label{kmain_8c}\index{/home/loudish/mpx-\/spring2017-\/modestus/mpx\+\_\+core/kernel/core/kmain.\+c@{/home/loudish/mpx-\/spring2017-\/modestus/mpx\+\_\+core/kernel/core/kmain.\+c}}
{\ttfamily \#include $<$stdint.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include $<$system.\+h$>$}\\*
{\ttfamily \#include $<$core/rtc.\+h$>$}\\*
{\ttfamily \#include $<$core/io.\+h$>$}\\*
{\ttfamily \#include $<$core/serial.\+h$>$}\\*
{\ttfamily \#include $<$core/tables.\+h$>$}\\*
{\ttfamily \#include $<$core/interrupts.\+h$>$}\\*
{\ttfamily \#include $<$core/anim.\+h$>$}\\*
{\ttfamily \#include $<$mem/heap.\+h$>$}\\*
{\ttfamily \#include $<$mem/paging.\+h$>$}\\*
{\ttfamily \#include $<$core/commhand.\+h$>$}\\*
{\ttfamily \#include $<$core/pcb.\+h$>$}\\*
{\ttfamily \#include \char`\"{}linked\+\_\+list.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}core/mpx\+\_\+supt.\+h\char`\"{}}\\*
Include dependency graph for kmain.\+c\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{kmain_8c__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{kmain_8c_a406c20548822065e144564476378f8a1}{kmain} (void)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\index{kmain.\+c@{kmain.\+c}!kmain@{kmain}}
\index{kmain@{kmain}!kmain.\+c@{kmain.\+c}}
\subsubsection[{\texorpdfstring{kmain(void)}{kmain(void)}}]{\setlength{\rightskip}{0pt plus 5cm}void kmain (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}\hypertarget{kmain_8c_a406c20548822065e144564476378f8a1}{}\label{kmain_8c_a406c20548822065e144564476378f8a1}


Definition at line 29 of file kmain.\+c.



References atoi(), cli, C\+O\+M1, get\+\_\+date(), get\+\_\+time(), hlt, init\+\_\+commhand(), init\+\_\+gdt(), init\+\_\+idt(), init\+\_\+irq(), init\+\_\+paging(), init\+\_\+pic(), init\+P\+C\+B\+Queues(), klogv(), list\+Test(), pcb\+Test(), printf, set\+\_\+serial\+\_\+in(), set\+\_\+serial\+\_\+out(), sprintf(), start\+\_\+up\+\_\+anim(), and strcat().


\begin{DoxyCode}
30 \{
31    \textcolor{keyword}{extern} \hyperlink{system_8h_a06896e8c53f721507066c079052171f8}{uint32\_t} magic;
32    \textcolor{comment}{// Uncomment if you want to access the multiboot header}
33    \textcolor{comment}{// extern void *mbd;}
34    \textcolor{comment}{// char *boot\_loader\_name = (char*)((long*)mbd)[16];}
35 
36    \textcolor{comment}{// 0) Initialize Serial I/O and call mpx\_init}
37    \hyperlink{system_8h_abdb09834267dd4a2a0d07d43ca4d230d}{klogv}(\textcolor{stringliteral}{"Starting MPX boot sequence..."});
38    \hyperlink{system_8h_abdb09834267dd4a2a0d07d43ca4d230d}{klogv}(\textcolor{stringliteral}{"Initialized serial I/O on COM1 device..."});
39    
40 \textcolor{comment}{// nick was here 1/19/17 and added more text}
41 \textcolor{comment}{//Gio was also here on 1/20/2017}
42 
43    \textcolor{comment}{//Added: matt-g 1/17/17}
44    \hyperlink{serial_8h_ae97b87ee1f57c687e7fca6f9958e03ef}{set\_serial\_out}(\hyperlink{serial_8h_a00dbb3ab1c59e14699be9393693e2248}{COM1});
45    \hyperlink{serial_8h_a3f4008da5feabfb7e086f6673a81104b}{set\_serial\_in}(\hyperlink{serial_8h_a00dbb3ab1c59e14699be9393693e2248}{COM1}); 
46 
47     \hyperlink{anim_8h_a5bf31d96ce4c2c86dfab5440a835c457}{start\_up\_anim}();
48    
49    \textcolor{comment}{//added matt-g 1/25/17}
50     \textcolor{keywordtype}{char} buf[500];
51    \textcolor{keywordtype}{char} *testarr = (\textcolor{keywordtype}{char}*)buf;
52 
53    \textcolor{keyword}{const} \textcolor{keywordtype}{char}* toCpy = \textcolor{stringliteral}{"testetst"};
54    testarr=\hyperlink{string_8h_a8908188ae9fc2f05d993257ef001d553}{strcat}(testarr,toCpy);
55    \hyperlink{string_8h_a0f459d16901ef591acaafa4b67fd4be5}{printf}(\textcolor{stringliteral}{"-%s-%s %s %d %s %c %s"},\textcolor{stringliteral}{"testtest"},\textcolor{stringliteral}{"matt"},\textcolor{stringliteral}{"jesse"},-938,\textcolor{stringliteral}{"gio"},\textcolor{charliteral}{'l'},\textcolor{stringliteral}{"nick"});
56    \hyperlink{string_8h_a0f459d16901ef591acaafa4b67fd4be5}{printf}(\textcolor{stringliteral}{"atoi test: %d\(\backslash\)r\(\backslash\)n"}, \hyperlink{string_8h_a30670a60464f77af17dfb353353d6df8}{atoi}(\textcolor{stringliteral}{"12 4"}));
57    \textcolor{comment}{//klogv(testarr);}
58 
59    \textcolor{keywordtype}{int} seconds = 30, minutes=49, hours=5;
60    \hyperlink{rtc_8h_a35fa24488cb7eb077e8dc995729202cf}{get\_time}(&hours,&minutes,&seconds);
61    \hyperlink{string_8h_ae9cac82f3293a00d8ec8705a3fc5cf64}{sprintf}(&testarr[0], 500, \textcolor{stringliteral}{"Hours %d, Minutes %d, Seconds %d"}, hours, minutes, seconds);
62    \hyperlink{system_8h_abdb09834267dd4a2a0d07d43ca4d230d}{klogv}(testarr);
63 
64    \textcolor{keywordtype}{int} day=25, month=12, year=2016;
65    \hyperlink{rtc_8h_ab43f56447c49f42bb4baee3e59e2d1f9}{get\_date}(&day, &month, &year);
66    \hyperlink{string_8h_ae9cac82f3293a00d8ec8705a3fc5cf64}{sprintf}(&testarr[0], 500, \textcolor{stringliteral}{"Day %d, Month %d, Year %d"}, day, month, year);
67    \hyperlink{system_8h_abdb09834267dd4a2a0d07d43ca4d230d}{klogv}(testarr);
68 
69    \textcolor{comment}{// 1) Check that the boot was successful and correct when using grub}
70    \textcolor{comment}{// Comment this when booting the kernel directly using QEMU, etc.}
71    \textcolor{keywordflow}{if} ( magic != 0x2BADB002 )\{
72      \textcolor{comment}{//kpanic("Boot was not error free. Halting.");}
73    \}
74    
75    \textcolor{comment}{// 2) Descriptor Tables}
76    \hyperlink{system_8h_abdb09834267dd4a2a0d07d43ca4d230d}{klogv}(\textcolor{stringliteral}{"Initializing Global descriptor table..."});
77    \hyperlink{tables_8h_a86bb50044169930202cc403376ef40c3}{init\_gdt}(); \textcolor{comment}{//Added: matt-g 17/1/18}
78    
79    \hyperlink{system_8h_abdb09834267dd4a2a0d07d43ca4d230d}{klogv}(\textcolor{stringliteral}{"Initializing Interrupt Descriptor table.."});
80    \hyperlink{tables_8h_a35fe413107af682030ab7a4b6dff19b8}{init\_idt}();
81    
82    \hyperlink{system_8h_abdb09834267dd4a2a0d07d43ca4d230d}{klogv}(\textcolor{stringliteral}{"Initializing Programmable interrupt controller"});
83    \hyperlink{interrupts_8h_afbc0dbef6f15e2df21b38724ea38c483}{init\_pic}();
84    
85    \hyperlink{system_8h_abdb09834267dd4a2a0d07d43ca4d230d}{klogv}(\textcolor{stringliteral}{"Installing interrupts..."});
86    \hyperlink{interrupts_8h_ad17d9a8aa78440af8fc40d3fd55dbad8}{init\_irq}();
87    
88    \hyperlink{system_8h_abdb09834267dd4a2a0d07d43ca4d230d}{klogv}(\textcolor{stringliteral}{"Enabling interrupts."});
89    \hyperlink{system_8h_a68c330e94fe121eba993e5a5973c3162}{cli}();
90 
91    \textcolor{comment}{// 4) Virtual Memory}
92    \hyperlink{system_8h_abdb09834267dd4a2a0d07d43ca4d230d}{klogv}(\textcolor{stringliteral}{"Initializing virtual memory..."});
93    \hyperlink{paging_8h_a919b727f386797a8b9d8eceb5c4e7313}{init\_paging}();
94 
95    \hyperlink{system_8h_abdb09834267dd4a2a0d07d43ca4d230d}{klogv}(\textcolor{stringliteral}{"Initializing PCB Memory"});
96    \hyperlink{pcb_8h_a8649777d644ec839c0d02d966f068f45}{initPCBQueues}();
97 
98    \textcolor{comment}{// 5) Call Commhand}
99    \hyperlink{system_8h_abdb09834267dd4a2a0d07d43ca4d230d}{klogv}(\textcolor{stringliteral}{"Transferring control to commhand..."});
100 
101    \hyperlink{linked__list_8h_a0a60ac1fe6e5055de61277ac9703b13e}{listTest}();
102 
103    \hyperlink{string_8h_a0f459d16901ef591acaafa4b67fd4be5}{printf}(\textcolor{stringliteral}{"%s%s"},\textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"},\textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"});
104 
105    \hyperlink{pcb_8h_adc4d10af06448eb7a046bacfc2918ea2}{pcbTest}();
106 
107     \hyperlink{commhand_8h_a5f6c259a5d805f1a24d35f36cb9207d3}{init\_commhand}();
108 
109    \textcolor{comment}{// 11) System Shutdown}
110    \hyperlink{system_8h_abdb09834267dd4a2a0d07d43ca4d230d}{klogv}(\textcolor{stringliteral}{"Starting system shutdown procedure..."});
111    
112    \textcolor{comment}{/* Shutdown Procedure */}
113    \hyperlink{system_8h_abdb09834267dd4a2a0d07d43ca4d230d}{klogv}(\textcolor{stringliteral}{"Shutdown complete. You may now turn off the machine. (QEMU: C-a x)"});
114    \hyperlink{system_8h_a954b0134ce21d80f0efb22c77e821da3}{hlt}();
115 \}
\end{DoxyCode}
