\hypertarget{heap_8h}{}\section{/home/loudish/mpx-\/spring2017-\/modestus/mpx\+\_\+core/include/mem/heap.h File Reference}
\label{heap_8h}\index{/home/loudish/mpx-\/spring2017-\/modestus/mpx\+\_\+core/include/mem/heap.\+h@{/home/loudish/mpx-\/spring2017-\/modestus/mpx\+\_\+core/include/mem/heap.\+h}}
This graph shows which files directly or indirectly include this file\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{heap_8h__dep__incl}
\end{center}
\end{figure}
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structheader}{header}
\item 
struct \hyperlink{structfooter}{footer}
\item 
struct \hyperlink{structindex__entry}{index\+\_\+entry}
\item 
struct \hyperlink{structindex__table}{index\+\_\+table}
\item 
struct \hyperlink{structheap}{heap}
\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{heap_8h_a032503e76d6f69bc67e99e909c8125da}{T\+A\+B\+L\+E\+\_\+\+S\+I\+ZE}~0x1000
\item 
\#define \hyperlink{heap_8h_a15073b9742f7e29d8174509197eb4ab9}{K\+H\+E\+A\+P\+\_\+\+B\+A\+SE}~0x\+D000000
\item 
\#define \hyperlink{heap_8h_aee52619f74498ad224eb8e4354b89e40}{K\+H\+E\+A\+P\+\_\+\+M\+IN}~0x10000
\item 
\#define \hyperlink{heap_8h_a0f2696767a10e6efffc64e9b459c4ea6}{K\+H\+E\+A\+P\+\_\+\+S\+I\+ZE}~0x1000000
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int} \hyperlink{heap_8h_a9bfb8053c2382598ef5b2175f475d49a}{\+\_\+kmalloc} (\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int} size, int align, \hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int} $\ast$phys\+\_\+addr)
\item 
\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int} \hyperlink{heap_8h_a15d6a52c5c080c8c7ffc73e336d8e574}{kmalloc} (\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int} size)
\item 
\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int} \hyperlink{heap_8h_aa2a6fb2aa05727dc1e7d72cbc108e63c}{kfree} ()
\item 
void \hyperlink{heap_8h_a755a69ff831b6e23a808dcf4b9944854}{init\+\_\+kheap} ()
\item 
\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int} \hyperlink{heap_8h_a2b1d5a9ba11695605f74fc10cd719af5}{alloc} (\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int} size, \hyperlink{structheap}{heap} $\ast$hp, int align)
\item 
\hyperlink{structheap}{heap} $\ast$ \hyperlink{heap_8h_a686135c02695aef4208f93d4549a15d0}{make\+\_\+heap} (\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int} \hyperlink{tables_8h_ab5763c2b18c825c8b8fba44b2e60ddc1}{base}, \hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int} max, \hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int} min)
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\index{heap.\+h@{heap.\+h}!K\+H\+E\+A\+P\+\_\+\+B\+A\+SE@{K\+H\+E\+A\+P\+\_\+\+B\+A\+SE}}
\index{K\+H\+E\+A\+P\+\_\+\+B\+A\+SE@{K\+H\+E\+A\+P\+\_\+\+B\+A\+SE}!heap.\+h@{heap.\+h}}
\subsubsection[{\texorpdfstring{K\+H\+E\+A\+P\+\_\+\+B\+A\+SE}{KHEAP_BASE}}]{\setlength{\rightskip}{0pt plus 5cm}\#define K\+H\+E\+A\+P\+\_\+\+B\+A\+SE~0x\+D000000}\hypertarget{heap_8h_a15073b9742f7e29d8174509197eb4ab9}{}\label{heap_8h_a15073b9742f7e29d8174509197eb4ab9}


Definition at line 6 of file heap.\+h.



Referenced by alloc(), and init\+\_\+paging().

\index{heap.\+h@{heap.\+h}!K\+H\+E\+A\+P\+\_\+\+M\+IN@{K\+H\+E\+A\+P\+\_\+\+M\+IN}}
\index{K\+H\+E\+A\+P\+\_\+\+M\+IN@{K\+H\+E\+A\+P\+\_\+\+M\+IN}!heap.\+h@{heap.\+h}}
\subsubsection[{\texorpdfstring{K\+H\+E\+A\+P\+\_\+\+M\+IN}{KHEAP_MIN}}]{\setlength{\rightskip}{0pt plus 5cm}\#define K\+H\+E\+A\+P\+\_\+\+M\+IN~0x10000}\hypertarget{heap_8h_aee52619f74498ad224eb8e4354b89e40}{}\label{heap_8h_aee52619f74498ad224eb8e4354b89e40}


Definition at line 7 of file heap.\+h.



Referenced by alloc(), and init\+\_\+paging().

\index{heap.\+h@{heap.\+h}!K\+H\+E\+A\+P\+\_\+\+S\+I\+ZE@{K\+H\+E\+A\+P\+\_\+\+S\+I\+ZE}}
\index{K\+H\+E\+A\+P\+\_\+\+S\+I\+ZE@{K\+H\+E\+A\+P\+\_\+\+S\+I\+ZE}!heap.\+h@{heap.\+h}}
\subsubsection[{\texorpdfstring{K\+H\+E\+A\+P\+\_\+\+S\+I\+ZE}{KHEAP_SIZE}}]{\setlength{\rightskip}{0pt plus 5cm}\#define K\+H\+E\+A\+P\+\_\+\+S\+I\+ZE~0x1000000}\hypertarget{heap_8h_a0f2696767a10e6efffc64e9b459c4ea6}{}\label{heap_8h_a0f2696767a10e6efffc64e9b459c4ea6}


Definition at line 8 of file heap.\+h.



Referenced by init\+\_\+paging().

\index{heap.\+h@{heap.\+h}!T\+A\+B\+L\+E\+\_\+\+S\+I\+ZE@{T\+A\+B\+L\+E\+\_\+\+S\+I\+ZE}}
\index{T\+A\+B\+L\+E\+\_\+\+S\+I\+ZE@{T\+A\+B\+L\+E\+\_\+\+S\+I\+ZE}!heap.\+h@{heap.\+h}}
\subsubsection[{\texorpdfstring{T\+A\+B\+L\+E\+\_\+\+S\+I\+ZE}{TABLE_SIZE}}]{\setlength{\rightskip}{0pt plus 5cm}\#define T\+A\+B\+L\+E\+\_\+\+S\+I\+ZE~0x1000}\hypertarget{heap_8h_a032503e76d6f69bc67e99e909c8125da}{}\label{heap_8h_a032503e76d6f69bc67e99e909c8125da}


Definition at line 5 of file heap.\+h.



\subsection{Function Documentation}
\index{heap.\+h@{heap.\+h}!\+\_\+kmalloc@{\+\_\+kmalloc}}
\index{\+\_\+kmalloc@{\+\_\+kmalloc}!heap.\+h@{heap.\+h}}
\subsubsection[{\texorpdfstring{\+\_\+kmalloc(u32int size, int align, u32int $\ast$phys\+\_\+addr)}{_kmalloc(u32int size, int align, u32int *phys_addr)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf u32int} \+\_\+kmalloc (
\begin{DoxyParamCaption}
\item[{{\bf u32int}}]{size, }
\item[{int}]{align, }
\item[{{\bf u32int} $\ast$}]{phys\+\_\+addr}
\end{DoxyParamCaption}
)}\hypertarget{heap_8h_a9bfb8053c2382598ef5b2175f475d49a}{}\label{heap_8h_a9bfb8053c2382598ef5b2175f475d49a}


Definition at line 24 of file heap.\+c.



References alloc(), page\+\_\+entry\+::frameaddr, get\+\_\+page(), and phys\+\_\+alloc\+\_\+addr.



Referenced by get\+\_\+page(), init\+\_\+paging(), and kmalloc().


\begin{DoxyCode}
25 \{
26   \hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int} *addr;
27 
28   \textcolor{comment}{// Allocate on the kernel heap if one has been created}
29   \textcolor{keywordflow}{if} (\hyperlink{heap_8c_a61825456a33b09780a5493c95adcae8a}{kheap} != 0)\{
30     addr = (\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}*)\hyperlink{heap_8c_a06dae34c7e7c73d518de00212a7c92da}{alloc}(size, \hyperlink{heap_8c_a61825456a33b09780a5493c95adcae8a}{kheap}, page\_align);
31     \textcolor{keywordflow}{if} (phys\_addr)\{
32       \hyperlink{structpage__entry}{page\_entry} *page = \hyperlink{paging_8h_a69b165b3d1adf3aeaae126ca7a5aac3e}{get\_page}((\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int})addr, \hyperlink{heap_8c_a61ce943ba80d9dfab89a826cae9ddc4a}{kdir}, 0);
33       *phys\_addr = (page->\hyperlink{structpage__entry_a68a6dc54a7ab6f7fb1a068476190bf67}{frameaddr}*0x1000) + ((\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int})addr & 0xFFF);
34     \}
35     \textcolor{keywordflow}{return} (\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int})addr;
36   \}
37   \textcolor{comment}{// Else, allocate directly from physical memory}
38   \textcolor{keywordflow}{else} \{
39     \textcolor{keywordflow}{if} (page\_align && (\hyperlink{heap_8c_a6dfa4ef84e115e891b3679e4932b5c49}{phys\_alloc\_addr} & 0xFFFFF000))\{
40       \hyperlink{heap_8c_a6dfa4ef84e115e891b3679e4932b5c49}{phys\_alloc\_addr} &= 0xFFFFF000;
41       \hyperlink{heap_8c_a6dfa4ef84e115e891b3679e4932b5c49}{phys\_alloc\_addr} += 0x1000;
42     \}
43     addr = (\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int}*)\hyperlink{heap_8c_a6dfa4ef84e115e891b3679e4932b5c49}{phys\_alloc\_addr};
44     \textcolor{keywordflow}{if} (phys\_addr)\{
45       *phys\_addr = \hyperlink{heap_8c_a6dfa4ef84e115e891b3679e4932b5c49}{phys\_alloc\_addr};
46     \}
47     \hyperlink{heap_8c_a6dfa4ef84e115e891b3679e4932b5c49}{phys\_alloc\_addr} += size;
48     \textcolor{keywordflow}{return} (\hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int})addr;
49   \}
50 \}
\end{DoxyCode}
\index{heap.\+h@{heap.\+h}!alloc@{alloc}}
\index{alloc@{alloc}!heap.\+h@{heap.\+h}}
\subsubsection[{\texorpdfstring{alloc(u32int size, heap $\ast$hp, int align)}{alloc(u32int size, heap *hp, int align)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf u32int} alloc (
\begin{DoxyParamCaption}
\item[{{\bf u32int}}]{size, }
\item[{{\bf heap} $\ast$}]{hp, }
\item[{int}]{align}
\end{DoxyParamCaption}
)}\hypertarget{heap_8h_a2b1d5a9ba11695605f74fc10cd719af5}{}\label{heap_8h_a2b1d5a9ba11695605f74fc10cd719af5}


Definition at line 57 of file heap.\+c.



References base, K\+H\+E\+A\+P\+\_\+\+B\+A\+SE, K\+H\+E\+A\+P\+\_\+\+M\+IN, no\+\_\+warn, and serial\+\_\+println().



Referenced by \+\_\+kmalloc().


\begin{DoxyCode}
58 \{
59   \hyperlink{system_8h_ab3bb695e7817363c7bdb781f214e83a2}{no\_warn}(size||align||h);
60   \textcolor{keyword}{static} \hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int} heap\_addr = \hyperlink{heap_8h_a15073b9742f7e29d8174509197eb4ab9}{KHEAP\_BASE};
61 
62   \hyperlink{system_8h_a757de76cafbcddaac0d1632902fe4cb8}{u32int} \hyperlink{tables_8h_ab5763c2b18c825c8b8fba44b2e60ddc1}{base} = heap\_addr;
63   heap\_addr += size;
64 
65   \textcolor{keywordflow}{if} (heap\_addr > \hyperlink{heap_8h_a15073b9742f7e29d8174509197eb4ab9}{KHEAP\_BASE} + \hyperlink{heap_8h_aee52619f74498ad224eb8e4354b89e40}{KHEAP\_MIN})
66     \hyperlink{serial_8h_a3514f7abff236a4e00a6c46021ce5e22}{serial\_println}(\textcolor{stringliteral}{"Heap is full!"});
67 
68   \textcolor{keywordflow}{return} \hyperlink{tables_8h_ab5763c2b18c825c8b8fba44b2e60ddc1}{base};
69 \}
\end{DoxyCode}
\index{heap.\+h@{heap.\+h}!init\+\_\+kheap@{init\+\_\+kheap}}
\index{init\+\_\+kheap@{init\+\_\+kheap}!heap.\+h@{heap.\+h}}
\subsubsection[{\texorpdfstring{init\+\_\+kheap()}{init_kheap()}}]{\setlength{\rightskip}{0pt plus 5cm}void init\+\_\+kheap (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{heap_8h_a755a69ff831b6e23a808dcf4b9944854}{}\label{heap_8h_a755a69ff831b6e23a808dcf4b9944854}
\index{heap.\+h@{heap.\+h}!kfree@{kfree}}
\index{kfree@{kfree}!heap.\+h@{heap.\+h}}
\subsubsection[{\texorpdfstring{kfree()}{kfree()}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf u32int} kfree (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{heap_8h_aa2a6fb2aa05727dc1e7d72cbc108e63c}{}\label{heap_8h_aa2a6fb2aa05727dc1e7d72cbc108e63c}
\index{heap.\+h@{heap.\+h}!kmalloc@{kmalloc}}
\index{kmalloc@{kmalloc}!heap.\+h@{heap.\+h}}
\subsubsection[{\texorpdfstring{kmalloc(u32int size)}{kmalloc(u32int size)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf u32int} kmalloc (
\begin{DoxyParamCaption}
\item[{{\bf u32int}}]{size}
\end{DoxyParamCaption}
)}\hypertarget{heap_8h_a15d6a52c5c080c8c7ffc73e336d8e574}{}\label{heap_8h_a15d6a52c5c080c8c7ffc73e336d8e574}


Definition at line 52 of file heap.\+c.



References \+\_\+kmalloc().



Referenced by init\+\_\+paging(), make\+\_\+heap(), and sys\+\_\+alloc\+\_\+mem().


\begin{DoxyCode}
53 \{
54   \textcolor{keywordflow}{return} \hyperlink{heap_8c_a014b54e36b61f133f53dd509c461f35e}{\_kmalloc}(size,0,0);
55 \}
\end{DoxyCode}
\index{heap.\+h@{heap.\+h}!make\+\_\+heap@{make\+\_\+heap}}
\index{make\+\_\+heap@{make\+\_\+heap}!heap.\+h@{heap.\+h}}
\subsubsection[{\texorpdfstring{make\+\_\+heap(u32int base, u32int max, u32int min)}{make_heap(u32int base, u32int max, u32int min)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf heap}$\ast$ make\+\_\+heap (
\begin{DoxyParamCaption}
\item[{{\bf u32int}}]{base, }
\item[{{\bf u32int}}]{max, }
\item[{{\bf u32int}}]{min}
\end{DoxyParamCaption}
)}\hypertarget{heap_8h_a686135c02695aef4208f93d4549a15d0}{}\label{heap_8h_a686135c02695aef4208f93d4549a15d0}


Definition at line 71 of file heap.\+c.



References kmalloc(), and no\+\_\+warn.



Referenced by init\+\_\+paging().


\begin{DoxyCode}
72 \{  
73   \hyperlink{system_8h_ab3bb695e7817363c7bdb781f214e83a2}{no\_warn}(\hyperlink{tables_8h_ab5763c2b18c825c8b8fba44b2e60ddc1}{base}||max||min);
74   \textcolor{keywordflow}{return} (\hyperlink{structheap}{heap}*)\hyperlink{heap_8c_a15d6a52c5c080c8c7ffc73e336d8e574}{kmalloc}(\textcolor{keyword}{sizeof}(\hyperlink{structheap}{heap}));
75 \}
\end{DoxyCode}
